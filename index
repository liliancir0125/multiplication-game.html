<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‰πù‰πù‰πòÊ≥ïÂ§ßÂÜíÈö™</title>
    <style>
        :root {
            --pink: #ffb8d1;
            --blue: #89cff0;
            --yellow: #fff59d;
            --text: #5d4037;
            --green: #77dd77;
            --red: #ff6961;
            --white: #ffffff;
        }

        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            color: var(--text);
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #fff9fb;
            background-image: radial-gradient(var(--pink) 1.5px, transparent 1.5px), 
                              radial-gradient(var(--blue) 1.5px, transparent 1.5px);
            background-size: 40px 40px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* È†ÇÈÉ®Â∞éË¶ΩÂàó */
        .nav-header {
            width: 100%;
            background: white;
            padding: 10px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--pink);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .btn-home {
            text-decoration: none;
            background: var(--yellow);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9rem;
            border: 2px solid var(--text);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .mode-selector {
            background: var(--pink);
            padding: 5px;
            border-radius: 50px;
            display: flex;
        }

        .mode-tab {
            padding: 6px 15px;
            border-radius: 50px;
            border: none;
            background: transparent;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .mode-tab.active {
            background: var(--white);
        }

        /* ÈÅäÊà≤‰∏ªÂç°Áâá */
        .card {
            width: 90%;
            max-width: 400px;
            background: var(--white);
            border: 8px solid var(--yellow);
            border-radius: 40px;
            padding: 30px 20px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(255, 184, 209, 0.3);
            margin-top: 20px;
        }

        .range-select {
            margin-bottom: 15px;
            padding: 10px 15px;
            border-radius: 20px;
            border: 2px solid var(--pink);
            font-size: 1rem;
            outline: none;
            background: white;
        }

        .display-area {
            font-size: 4rem;
            font-weight: bold;
            margin: 20px 0;
            min-height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .display-area span { color: var(--blue); }
        .answer-box {
            display: inline-block;
            min-width: 80px;
            border-bottom: 5px solid var(--pink);
            color: var(--pink);
            margin-left: 10px;
        }

        /* ËôõÊì¨ÈçµÁõ§ */
        .keypad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            width: 90%;
            max-width: 400px;
            padding: 20px 10px;
        }

        .key {
            background: var(--white);
            border: 3px solid var(--blue);
            border-radius: 25px;
            padding: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 0 var(--blue);
        }

        .key:active { transform: translateY(4px); box-shadow: 0 1px 0 var(--blue); }
        .key.special { background: var(--pink); border-color: #e0a0b8; box-shadow: 0 5px 0 #e0a0b8; color: white; }
        .key.ok { background: var(--yellow); border-color: #f0e68c; box-shadow: 0 5px 0 #f0e68c; }

        .nav-controls {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 10px;
        }

        .nav-btn {
            background: var(--blue);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 30px;
            font-size: 1.1rem;
            box-shadow: 0 5px 0 #6eb5d8;
        }

        .feedback {
            position: fixed;
            top: 40%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            pointer-events: none;
            opacity: 0;
            z-index: 100;
        }

        .pop { animation: popAnim 0.8s ease-out forwards; }
        @keyframes popAnim {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 0; }
        }

        /* ÁâàÊú¨Ëôü */
        .version-tag {
            position: fixed;
            bottom: 8px;
            right: 12px;
            font-size: 11px;
            color: var(--text);
            opacity: 0.5;
            background: rgba(255,255,255,0.7);
            padding: 2px 6px;
            border-radius: 4px;
        }
    </style>
</head>
<body>

    <div class="nav-header">
        <a href="https://liliancir0125.github.io/Rumi_Study_Hall/" class="btn-home">üè† ÂõûÂ§ßÂª≥</a>
        <div class="mode-selector">
            <button class="mode-tab active" id="tab-recite" onclick="switchMode('recite')">ËÉåË™¶</button>
            <button class="mode-tab" id="tab-quiz" onclick="switchMode('quiz')">Ê∏¨È©ó</button>
        </div>
    </div>

    <div class="card">
        <select class="range-select" id="rangeSelect" onchange="initGame()">
            <option value="2">2 ÁöÑ‰πòÊ≥ï</option>
            <option value="3">3 ÁöÑ‰πòÊ≥ï</option>
            <option value="4">4 ÁöÑ‰πòÊ≥ï</option>
            <option value="5">5 ÁöÑ‰πòÊ≥ï</option>
            <option value="6">6 ÁöÑ‰πòÊ≥ï</option>
            <option value="7">7 ÁöÑ‰πòÊ≥ï</option>
            <option value="8">8 ÁöÑ‰πòÊ≥ï</option>
            <option value="9">9 ÁöÑ‰πòÊ≥ï</option>
            <option value="random">üåü Á∂úÂêàÂ§ßÊåëÊà∞</option>
        </select>

        <div class="display-area" id="displayArea"></div>

        <div id="reciteControls" class="nav-controls">
            <button class="nav-btn" onclick="prevStep()">‰∏ä‰∏ÄÂÄã</button>
            <button class="nav-btn" onclick="nextStep()">‰∏ã‰∏ÄÂÄã</button>
        </div>
    </div>

    <div class="keypad" id="keypad" style="display: none;">
        <button class="key" onclick="pressNum(1)">1</button>
        <button class="key" onclick="pressNum(2)">2</button>
        <button class="key" onclick="pressNum(3)">3</button>
        <button class="key" onclick="pressNum(4)">4</button>
        <button class="key" onclick="pressNum(5)">5</button>
        <button class="key" onclick="pressNum(6)">6</button>
        <button class="key" onclick="pressNum(7)">7</button>
        <button class="key" onclick="pressNum(8)">8</button>
        <button class="key" onclick="pressNum(9)">9</button>
        <button class="key special" onclick="userInput='';renderQuiz()">C</button>
        <button class="key" onclick="pressNum(0)">0</button>
        <button class="key ok" onclick="checkAnswer()">OK</button>
    </div>

    <div class="feedback" id="feedback"></div>
    <div class="version-tag">Ver. 1.0.2</div>

    <script>
        let currentMode = 'recite';
        let currentNum = 2;
        let currentStep = 1;
        let quizA = 2, quizB = 1;
        let userInput = "";

        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function switchMode(mode) {
            currentMode = mode;
            document.getElementById('tab-recite').classList.toggle('active', mode === 'recite');
            document.getElementById('tab-quiz').classList.toggle('active', mode === 'quiz');
            document.getElementById('reciteControls').style.display = (mode === 'recite' ? 'flex' : 'none');
            document.getElementById('keypad').style.display = (mode === 'quiz' ? 'grid' : 'none');
            initGame();
        }

        function initGame() {
            const range = document.getElementById('rangeSelect').value;
            userInput = "";
            if (currentMode === 'recite') {
                if (range !== 'random') currentNum = parseInt(range);
                currentStep = 1;
                renderRecite();
            } else {
                generateQuiz();
            }
        }

        function renderRecite() {
            const display = document.getElementById('displayArea');
            display.innerHTML = `<div>${currentNum} <span>√ó</span> ${currentStep} = ${currentNum * currentStep}</div>`;
        }

        function nextStep() {
            if (currentStep < 9) { currentStep++; renderRecite(); }
            else if (document.getElementById('rangeSelect').value === 'random') {
                currentNum = Math.floor(Math.random() * 8) + 2;
                currentStep = 1;
                renderRecite();
            }
        }

        function prevStep() { if (currentStep > 1) { currentStep--; renderRecite(); } }

        function generateQuiz() {
            const range = document.getElementById('rangeSelect').value;
            quizA = (range === 'random') ? Math.floor(Math.random() * 8) + 2 : parseInt(range);
            quizB = Math.floor(Math.random() * 9) + 1;
            userInput = "";
            renderQuiz();
        }

        function renderQuiz() {
            const display = document.getElementById('displayArea');
            display.innerHTML = `<div>${quizA} <span>√ó</span> ${quizB} = <span class="answer-box">${userInput || '?'}</span></div>`;
        }

        function pressNum(n) { if (userInput.length < 2) { userInput += n; renderQuiz(); } }

        function checkAnswer() {
            const correct = quizA * quizB;
            const fb = document.getElementById('feedback');
            if (parseInt(userInput) === correct) {
                fb.innerText = "‚≠ê Á≠îÂ∞ç‰∫ÜÔºÅ"; fb.style.color = "var(--green)"; fb.className = "feedback pop";
                setTimeout(() => { fb.className = "feedback"; generateQuiz(); }, 1500);
            } else {
                fb.innerText = "‚ùå ÂÜçË©¶‰∏ÄÊ¨°"; fb.style.color = "var(--red)"; fb.className = "feedback pop";
                setTimeout(() => { fb.className = "feedback"; userInput = ""; renderQuiz(); }, 1000);
            }
        }

        window.onload = initGame;
    </script>
</body>
</html>
